<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/ui-darkness/jquery-ui-1.8.2.custom.css">

        <script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
        <script type="text/javascript" src="js/jquery-ui-1.8.2.custom.min.js"></script>

        <style>
            body, div, a { font-family: 'Droid Sans', sans-serif; font-size: xx-large; }
            body { background: #111; }
            div.item { padding: 10px; }
            div.item a:link,
            div.item a:active,
            div.item a:hover,
            div.item a:visited { text-decoration: none; }
        </style>
    </head>

    <body>
        <div id="files"></div>
        <script>
            var old_el = null;

            var play_file = function(fullpath)
            {
                $.get('htpicker://play_file?fullpath=' + fullpath);
            }

            var activate = function(fullpath, type)
            {
                if(type == 'directory')
                    load_files(fullpath);
                else
                    play_file(fullpath);
            }

            var htmlDecode = function(input)
            {
                var e = document.createElement('div');
                e.innerHTML = input;
                return e.childNodes[0].nodeValue;
            }

            var load_files = function(path) {
                var qs = '';
                if(path)
                    qs = '?directory=' + encodeURI(path);

                $.getJSON('htpicker://list_files' + qs, function(data) {
                    var files = data['files'];
                    $('#files').html('');
                    for(var i = 0; i < files.length; i++)
                    {
                        var css_classes = 'ui-widget-header item';

                        var focusin_cb = function(i) {
                            return function(ev) {
                                $('#file-'+i).addClass("ui-state-hover");
                            };
                        }(i);

                        var focusout_cb = function(i) {
                            return function(ev) {
                                $('#file-'+i).removeClass("ui-state-hover");
                            };
                        }(i);

                        $('#files').append(
                            ($('<div>')
                                .attr('id', 'file-'+i)
                                .attr('class', css_classes)
                                .focusin(focusin_cb)
                                .focusout(focusout_cb)
                                .mouseover(focusin_cb)
                                .mouseout(focusout_cb)
                                .append(
                                    $('<a>')
                                        .attr('href', '#')
                                        .click(function(file) {
                                            return function(ev) {
                                                activate(file['fullpath'], file['type']);
                                            };
                                        }(files[i]))
                                        .html(files[i]['display_name'])
                                )
                            )
                        );
                    }
                });
            }

            $(function() {
                $.getJSON('htpicker://get_initial_dir', function(data) {
                    var initial_dir = data['initial_dir'];
                    load_files(initial_dir);
                });
            });
        </script>
    </body>
</html>
